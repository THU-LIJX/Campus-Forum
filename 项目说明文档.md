## 项目说明文档

##### 孟德华 2019013289	李家鑫 2019011246	邱俣涵 2018012398

github仓库：https://github.com/THU-LIJX/Campus-Forum

### 代码说明
#### 前端代码
使用Java编写，除了安卓基本的框架外还使用了第三方开源库PictureSelector实现图片的选择。代码在frontend中。

#### 后端代码
使用Go语言编写，数据库采用MongoDB。主要使用的框架为Web框架Gin和连接数据库的mongo-driver。代码在backend中。

#### 运行方式
##### 连接部署好的后端
不需要修改任何代码，使用Android Studio启动前端。**要求连接互联网**。

此时前端连接到部署在腾讯云服务器上的后端，地址为`http://qiuyuhan.xyz:8080`。使用GET方法请求`http://qiuyuhan.xyz:8080/ping`测试服务是否正常开启，如有问题请联系我们。服务器带宽较小，加载图片可能较慢。

##### 本地测试
需要修改代码。对于后端，请取消`main.go`第52行的注释。根据本机系统修改`config.yaml`中的`static`这个配置，来指定静态文件存放的根目录。确保机器上有Go1.18，使用`go build`构建后运行后端。运行时会在控制台打印出IP地址，记住这个地址。

对于前端，修改`HttpUtil`中的变量`baseUrl`为上一步中获取的IP地址，连接到和后端同样的网络环境后再运行。此时前端连接到的是本地运行后端，速度更快。

###  关键功能的设计与实现技术

根据给出的需求逐一介绍

#### 用户

1. + 需求：通过邮箱注册账号，设置密码
   + 实现：在注册页面中，用户需要填写邮箱、用户名、密码，注册之后我们会向邮箱发送一封验证邮件，用户需要点击邮件中的链接进行验证，否则在我们的app中的权限会受到限制
2. + 需求：修改用户名，头像，简介，密码
   + 实现：在编辑信息页面中，用户可以点击头像拉取相册，从中选取图片更换头像，在输入框中修改用户名、简介、密码等信息
3. + 需求：对用户进行关注和取关，显示关注列表，在动态页面的用户名后边显示“已关注”
   + 实现：我们提供了多种方式来关注用户，第一种是通过动态右边的关注按钮，第二种是访问用户的主页，主页右边也有关注按钮；在用户主页里，会显示“已关注xx人”，点击这个文本就会跳转到关注列表页面；对于已关注的用户，我们会在动态后面显示“取关”，这与“已关注”能起到同样的作用，并且能提醒用户该按钮的功能
4. + 需求：对用户进行屏蔽，并不显示其动态
   + 实现：当用户访问其他用户的主页时，通过右上方的屏蔽按钮就能把对应的用户屏蔽
5. + 需求：个人主页显示本人发布的所有动态
   + 实现：在用户的个人主页下面使用recyclerView展示用户的所有动态
6. + 需求：从作品、评论等界面进入他人的个人主页
   + 实现：用户的动态、评论中都会显示用户的头像，点击头像即可进入对应用户的主页
7. + 需求：草稿页面保存未发布的作品草稿
   + 实现：在用户的草稿页面下使用recyclerView展示用户所有的草稿，左侧的icon会显示草稿对应的动态的类型
8. + 需求：进入一篇草稿的编辑界面继续进行编辑或者删除
   + 实现：点击后从对应的草稿文件中读取信息并加载，变为普通的编辑动态和发布界面

#### 发布
1. + 需求：发布纯文字动态
   + 实现：用户直接在TextEdit中编辑标题与内容即可
2. + 需求：图文混合动态与视频动态
   + 实现：使用开源库PictureSelector来实现图片与视频的选择，一次最多选择一个视频或者9张图片。以九宫格的形式展示。
3. + 需求：音频动态
   + 实现：使用MediaRecorder完成录音。用户需要点击界面右下角按钮切换到录音界面，可以点击进度条预览自己录的音频。
4. + 需求：添加位置
   + 实现：调用手机定位获取当前经纬度，Geocoder把经纬度转化为地址即可。
5. + 需求：自动保存草稿
   + 实现：每当用户进行编辑的时候都会触发保存函数，把当前编辑的内容包括选择的资源文件存到一个json文件中，供草稿箱页面读取。


#### 查看

1. + 需求：选择根据时间顺序或者点赞数量进行动态展示
   + 实现：在动态浏览页面，点击右上方的图标，会显示一个菜单，可以选择根据时间、点赞数量进行排序（默认使用时间倒序，不使用点赞排序），重复选择同一个排序选项会取消掉该筛选条件（比如点两次“时间倒序”，就会取消掉时间这个筛选条件）
2. + 需求：选择根据所有人或者已关注的人进行动态展示
   + 实现：在动态浏览页面，点击右上方的图标，在菜单中可以选择展示所有人、已关注的人的动态
3. + 需求：对动态进行点赞（展示所有的点赞人信息）
   + 实现：在动态左下角有一个点赞图标，如果没有点赞过该动态，点击即可对该动态点赞
4. + 需求：对动态进行评论（展示所有的回复信息）
   + 实现：在动态下面有一个评论图标，点击进入到动态详情页面，在动态详情页面可以进行评论
5. + 需求：对动态进行分享（分享到任何其他可展示内容的APP中）
   + 实现：点击动态右下角的分享图标，就可以通过ShareCompat进行分享
6. + 需求：可以取消点赞，删除评论
   + 实现：点赞之后，再次点击点赞按钮就可以取消点赞；在动态详情页面中的评论区部分，对于自己的评论，可以通过点击评论右上角的删除图标将评论删除

#### 通知

1. + 需求：接收到来⾃平台的通知消息，包括⾃⼰作品的点赞与评论，以及关注作者的更新 
   + 实现：当用户进入消息列表页面时，会从后端获取通知信息，包括了需求中的所有信息，并且会提示用户哪些通知已读、未读
2. + 需求：⽤⼾从个⼈中⼼界⾯进⼊通知消息列表
   + 实现：在app的主页面中，点击底部导航栏中的第二个图标就能静如通知消息列表页面

#### 搜索
1. + 需求：根据动态名称，动态内容，用户名称，作品类型（文图音视，在动态发布时选择）四种方式搜索内容
   + 实现：在搜索页面，我们给出了上述需要的筛选方式，在选择好筛选方式之后，点击搜索，就会从后端获取对应的动态，然后在底部进行展示
2. + 需求：搜索时实现模糊搜索
   + 实现：使用mongodb自带的模糊搜索

#### 系统支持
+ 需求：APP 应该被正确地签名打包，在指定版本的 Android 虚拟机及 Android智能手机上可以正常运行，不出现崩溃情况或 UI 样式错乱情况
+ 实现：app可以正常打包。我们在android虚拟机、华为、小米等机型上测试时，app可以正常运行

#### UI设计与交互

我们的APP界面主要包含以下页面：登录页面、注册页面、动态浏览页面、动态详情页面、消息通知页面、草稿箱页面、动态编辑页面、用户主页页面、用户编辑信息页面、点赞列表、关注列表页面

### 设计亮点以及额外功能

1. 动态中的图片展示，我们使用了类似qq、微信等软件的九宫格展示，会根据图片数量调整布局
2. 编辑语音动态时，会有录音条展示录音时间，点击停止录音后，可以预览语音
3. 需要用户验证邮箱，防止用户随意使用他人邮箱注册
4. APP的UI风格统一，样式合理

### 分工情况

| 成员   | 分工                                                         |
| ------ | ------------------------------------------------------------ |
| 孟德华 | android前端开发，负责用户个人信息、搜索等页面                |
| 李家鑫 | android前端开发，负责动态浏览、动态详情、通知等页面          |
| 邱俣涵 | go后端开发，完成项目后端。android前端开发，完成动态发布、草稿页面 |

